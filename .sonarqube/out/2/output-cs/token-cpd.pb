êΩ
:B:\Github\asagiv.dbmanager\asagiv.dbmanager\DbFunctions.cs
	namespace 	
asagiv
 
. 
	dbmanager 
{ 
internal 
static 
class 
DbFunctions %
{ 
private 
static 
StreamWriter #
	getStream$ -
(- .
). /
{ 	
var 
sw 
= 
new 
StreamWriter %
(% &
$str& [
)[ \
;\ ]
return 
sw 
; 
} 	
public 
static 
async 
Task  "
createAddressListAsync! 7
(7 8
MainDbContext8 E
	dbContextF O
)O P
{ 	
var 

peopleList 
= 
await "
	dbContext# ,
., -
People- 3
. 
Join 
( 
	dbContext 
.  #
RobertBabyAnnouncements  7
,7 8
p   
=>   
p   
.   
PeopleId   #
,  # $
a!! 
=>!! 
a!! 
.!! 
PeopleId!! #
,!!# $
("" 
p"" 
,"" 
a"" 
)"" 
=>"" 
new"" !
{""" #
p""$ %
,""% &
a""' (
}"") *
)""* +
.## 
OrderBy## 
(## 
x## 
=>## 
x## 
.##  
p##  !
.##! "

FamilyName##" ,
)##, -
.$$ 
ToDictionaryAsync$$ "
($$" #
x$$# $
=>$$% '
x$$( )
.$$) *
p$$* +
,$$+ ,
x$$- .
=>$$/ 1
x$$2 3
.$$3 4
a$$4 5
)$$5 6
;$$6 7

listPeople&& 
(&& 

peopleList&& !
)&&! "
;&&" #
}'' 	
public)) 
static)) 
void)) 

listPeople)) %
())% &
IDictionary))& 1
<))1 2
People))2 8
,))8 9#
RobertBabyAnnouncements)): Q
>))Q R

peopleList))S ]
)))] ^
{** 	
using++ 
var++ 
tw++ 
=++ 
	getStream++ $
(++$ %
)++% &
;++& '
foreach-- 
(-- 
var-- 
person-- 
in--  "

peopleList--# -
)--- .
{.. 
var// 
name// 
=// 
string// !
.//! "
IsNullOrWhiteSpace//" 4
(//4 5
person//5 ;
.//; <
Value//< A
?//A B
.//B C

CustomName//C M
)//M N
?00 
person00 
.00 
Key00  
.00  !
Name00! %
:11 
person11 
.11 
Value11 "
.11" #

CustomName11# -
;11- .
var33 
stateCountry33  
=33! "
person33# )
.33) *
Key33* -
.33- .
Country33. 5
==336 8
$str339 >
?44 
person44 
.44 
Key44  
.44  !
State44! &
:55 
person55 
.55 
Key55  
.55  !
Country55! (
;55( )
tw77 
.77 
	WriteLine77 
(77 
name77 !
)77! "
;77" #
tw88 
.88 
	WriteLine88 
(88 
person88 #
.88# $
Key88$ '
.88' (
Street88( .
)88. /
;88/ 0
tw99 
.99 
	WriteLine99 
(99 
$"99 
{99  
person99  &
.99& '
Key99' *
.99* +
City99+ /
}99/ 0
, 990 2
{992 3
stateCountry993 ?
}99? @
"99@ A
)99A B
;99B C
if:: 
(:: 
!:: 
string:: 
.:: 
IsNullOrWhiteSpace:: .
(::. /
person::/ 5
.::5 6
Key::6 9
.::9 :
Zip::: =
)::= >
)::> ?
tw::@ B
.::B C
	WriteLine::C L
(::L M
person::M S
.::S T
Key::T W
.::W X
Zip::X [
)::[ \
;::\ ]
tw== 
.== 
	WriteLine== 
(== 
)== 
;== 
}>> 
}?? 	
publicAA 
staticAA 
asyncAA 
TaskAA   
importAddressesAsyncAA! 5
(AA5 6
MainDbContextAA6 C
	dbContextAAD M
,AAM N
stringAAO U
fileNameAAV ^
)AA^ _
{BB 	
varCC 
importedCsvPeopleCC !
=CC" #
newCC$ '
ListCC( ,
<CC, -
ListCC- 1
<CC1 2
stringCC2 8
>CC8 9
>CC9 :
(CC: ;
)CC; <
;CC< =
usingEE 
(EE 
varEE 
srEE 
=EE 
newEE 
StreamReaderEE  ,
(EE, -
fileNameEE- 5
)EE5 6
)EE6 7
{FF 
whileGG 
(GG 
!GG 
srGG 
.GG 
EndOfStreamGG &
)GG& '
{HH 
intII 
	numCommasII !
=II" #
$numII$ %
;II% &
varJJ 
stringBuilderJJ %
=JJ& '
newJJ( +
StringBuilderJJ, 9
(JJ9 :
)JJ: ;
;JJ; <
whileLL 
(LL 
	numCommasLL $
<LL% &
$numLL' (
)LL( )
{MM 
varNN 
lineNN  
=NN! "
awaitNN# (
srNN) +
.NN+ ,
ReadLineAsyncNN, 9
(NN9 :
)NN: ;
;NN; <
ifPP 
(PP 
	numCommasPP %
>PP& '
$numPP( )
)PP) *
stringBuilderQQ )
.QQ) *
AppendQQ* 0
(QQ0 1
$charQQ1 5
)QQ5 6
;QQ6 7
stringBuilderSS %
.SS% &
AppendSS& ,
(SS, -
lineSS- 1
)SS1 2
;SS2 3
	numCommasUU !
+=UU" $
stringBuilderUU% 2
.VV 
ToStringVV %
(VV% &
)VV& '
.WW 
CountWW "
(WW" #
xWW# $
=>WW% '
xWW( )
==WW* ,
$charWW- 0
)WW0 1
;WW1 2
}XX 
importedCsvPeopleZZ %
.ZZ% &
AddZZ& )
(ZZ) *
stringBuilderZZ* 7
.ZZ7 8
ToStringZZ8 @
(ZZ@ A
)ZZA B
.ZZB C
SplitZZC H
(ZZH I
$charZZI L
)ZZL M
.ZZM N
ToListZZN T
(ZZT U
)ZZU V
)ZZV W
;ZZW X
}[[ 
}\\ 
;\\ 
var^^ 
headerColumn^^ 
=^^ 
importedCsvPeople^^ 0
.^^0 1
FirstOrDefault^^1 ?
(^^? @
)^^@ A
;^^A B
if`` 
(`` 
headerColumn`` 
==`` 
null``  $
)``$ %
throwaa 
newaa 
	Exceptionaa #
(aa# $
$straa$ I
)aaI J
;aaJ K
varcc 

nameColumncc 
=cc 
headerColumncc )
.cc) *
	FindIndexcc* 3
(cc3 4
xcc4 5
=>cc6 8
xcc9 :
==cc; =
$strcc> D
)ccD E
;ccE F
vardd 
streetColumndd 
=dd 
headerColumndd +
.dd+ ,
	FindIndexdd, 5
(dd5 6
xdd6 7
=>dd8 :
xdd; <
==dd= ?
$strdd@ I
)ddI J
;ddJ K
varee 

cityColumnee 
=ee 
headerColumnee )
.ee) *
	FindIndexee* 3
(ee3 4
xee4 5
=>ee6 8
xee9 :
==ee; =
$stree> D
)eeD E
;eeE F
varff 
stateColumnff 
=ff 
headerColumnff *
.ff* +
	FindIndexff+ 4
(ff4 5
xff5 6
=>ff7 9
xff: ;
==ff< >
$strff? F
)ffF G
;ffG H
vargg 
	zipColumngg 
=gg 
headerColumngg (
.gg( )
	FindIndexgg) 2
(gg2 3
xgg3 4
=>gg5 7
xgg8 9
==gg: <
$strgg= B
)ggB C
;ggC D
varhh 
countryColumnhh 
=hh 
headerColumnhh  ,
.hh, -
	FindIndexhh- 6
(hh6 7
xhh7 8
=>hh9 ;
xhh< =
==hh> @
$strhhA J
)hhJ K
;hhK L
varii 
familyNameColumnii  
=ii! "
headerColumnii# /
.ii/ 0
	FindIndexii0 9
(ii9 :
xii: ;
=>ii< >
xii? @
==iiA C
$striiD Q
)iiQ R
;iiR S
varkk 
peoplekk 
=kk 
importedCsvPeoplekk *
.ll 
Skipll 
(ll 
$numll 
)ll 
.mm 
Wheremm 
(mm 
xmm 
=>mm 
xmm 
.mm 
Countmm #
==mm$ &
$nummm' (
)mm( )
.nn 
Selectnn 
(nn 
personCsvRownn $
=>nn% '
{oo 
varpp 
streetpp 
=pp  
personCsvRowpp! -
[pp- .
streetColumnpp. :
]pp: ;
;pp; <
varrr 
countryrr 
=rr  !
stringrr" (
.rr( )
IsNullOrWhiteSpacerr) ;
(rr; <
personCsvRowrr< H
[rrH I
countryColumnrrI V
]rrV W
)rrW X
?ss 
nullss 
:tt 
personCsvRowtt &
[tt& '
countryColumntt' 4
]tt4 5
;tt5 6
varvv 
zipvv 
=vv 
personCsvRowvv *
[vv* +
	zipColumnvv+ 4
]vv4 5
.vv5 6
ToStringvv6 >
(vv> ?
)vv? @
;vv@ A
whilexx 
(xx 
zipxx 
.xx 
Countxx $
(xx$ %
)xx% &
<xx' (
$numxx) *
)xx* +
{yy 
zipzz 
=zz 
zipzz !
.zz! "
Insertzz" (
(zz( )
$numzz) *
,zz* +
$strzz, /
)zz/ 0
;zz0 1
}{{ 
return}} 
new}} 
People}} %
(}}% &
)}}& '
{~~ 
Name 
= 
personCsvRow +
[+ ,

nameColumn, 6
]6 7
,7 8
Street
ÄÄ 
=
ÄÄ  
street
ÄÄ! '
,
ÄÄ' (
City
ÅÅ 
=
ÅÅ 
personCsvRow
ÅÅ +
[
ÅÅ+ ,

cityColumn
ÅÅ, 6
]
ÅÅ6 7
,
ÅÅ7 8
State
ÇÇ 
=
ÇÇ 
personCsvRow
ÇÇ  ,
[
ÇÇ, -
stateColumn
ÇÇ- 8
]
ÇÇ8 9
,
ÇÇ9 :
Zip
ÉÉ 
=
ÉÉ 
personCsvRow
ÉÉ *
[
ÉÉ* +
	zipColumn
ÉÉ+ 4
]
ÉÉ4 5
,
ÉÉ5 6
Country
ÑÑ 
=
ÑÑ  !
country
ÑÑ" )
,
ÑÑ) *

FamilyName
ÖÖ "
=
ÖÖ# $
personCsvRow
ÖÖ% 1
[
ÖÖ1 2
familyNameColumn
ÖÖ2 B
]
ÖÖB C
,
ÖÖC D
}
ÜÜ 
;
ÜÜ 
}
áá 
)
áá 
.
àà 
ToList
àà 
(
àà 
)
àà 
;
àà 
await
ää 
	dbContext
ää 
.
ää 
People
ää "
.
ää" #
AddRangeAsync
ää# 0
(
ää0 1
people
ää1 7
)
ää7 8
;
ää8 9
await
ãã 
	dbContext
ãã 
.
ãã 
SaveChangesAsync
ãã ,
(
ãã, -
)
ãã- .
;
ãã. /
}
åå 	
public
éé 
static
éé 
async
éé 
Task
éé  0
"addPeopleToBirthAnnouncementsAsync
éé! C
(
ééC D
MainDbContext
ééD Q
	dbContext
ééR [
)
éé[ \
{
èè 	
var
êê 
announcementIds
êê 
=
êê  !
await
êê" '
	dbContext
êê( 1
.
ëë %
RobertBabyAnnouncements
ëë (
.
íí 
Select
íí 
(
íí 
x
íí 
=>
íí 
x
íí 
.
íí 
PeopleId
íí '
)
íí' (
.
ìì 
ToListAsync
ìì 
(
ìì 
)
ìì 
;
ìì 
var
ïï (
peopleWithoutAnnouncements
ïï *
=
ïï+ ,
await
ïï- 2
	dbContext
ïï3 <
.
ññ 
People
ññ 
.
óó 
Where
óó 
(
óó 
x
óó 
=>
óó 
!
óó 
announcementIds
óó ,
.
óó, -
Contains
óó- 5
(
óó5 6
x
óó6 7
.
óó7 8
PeopleId
óó8 @
)
óó@ A
)
óóA B
.
òò 
OrderBy
òò 
(
òò 
x
òò 
=>
òò 
x
òò 
.
òò  

FamilyName
òò  *
)
òò* +
.
ôô 
ToListAsync
ôô 
(
ôô 
)
ôô 
;
ôô 
foreach
õõ 
(
õõ 
var
õõ 
person
õõ 
in
õõ  "(
peopleWithoutAnnouncements
õõ# =
)
õõ= >
{
úú 
Console
ùù 
.
ùù 
Write
ùù 
(
ùù 
$"
ùù  $
Would you like to add 
ùù  6
{
ùù6 7
person
ùù7 =
.
ùù= >
Name
ùù> B
}
ùùB C
?: 
ùùC F
"
ùùF G
)
ùùG H
;
ùùH I
var
ûû 
result
ûû 
=
ûû 
Console
ûû $
.
ûû$ %
ReadLine
ûû% -
(
ûû- .
)
ûû. /
;
ûû/ 0
if
†† 
(
†† 
result
†† 
!=
†† 
$str
†† !
)
††! "
continue
††# +
;
††+ ,
	dbContext
¢¢ 
.
¢¢ %
RobertBabyAnnouncements
¢¢ 1
.
¢¢1 2
Add
¢¢2 5
(
¢¢5 6
new
¢¢6 9%
RobertBabyAnnouncements
¢¢: Q
{
££ 
PeopleId
§§ 
=
§§ 
person
§§ %
.
§§% &
PeopleId
§§& .
}
•• 
)
•• 
;
•• 
}
¶¶ 
	dbContext
®® 
.
®® 
SaveChanges
®® !
(
®®! "
)
®®" #
;
®®# $
}
©© 	
public
´´ 
static
´´ 
async
´´ 
Task
´´   
addCustomNameAsync
´´! 3
(
´´3 4
MainDbContext
´´4 A
	dbContext
´´B K
)
´´K L
{
¨¨ 	
Console
≠≠ 
.
≠≠ 
	WriteLine
≠≠ 
(
≠≠ 
$str
≠≠ 1
)
≠≠1 2
;
≠≠2 3
Console
ØØ 
.
ØØ 
Write
ØØ 
(
ØØ 
$str
ØØ 5
)
ØØ5 6
;
ØØ6 7
var
∞∞ 

familyName
∞∞ 
=
∞∞ 
Console
∞∞ $
.
∞∞$ %
ReadLine
∞∞% -
(
∞∞- .
)
∞∞. /
;
∞∞/ 0
var
≤≤ 
person
≤≤ 
=
≤≤ %
getPersonFromFamilyName
≤≤ 0
(
≤≤0 1
	dbContext
≤≤1 :
,
≤≤: ;

familyName
≤≤< F
)
≤≤F G
;
≤≤G H
if
¥¥ 
(
¥¥ 
person
¥¥ 
==
¥¥ 
null
¥¥ 
)
¥¥ 
return
¥¥  &
;
¥¥& '
var
∂∂ 
announcement
∂∂ 
=
∂∂ 
await
∂∂ $
	dbContext
∂∂% .
.
∑∑ %
RobertBabyAnnouncements
∑∑ (
.
∏∏ !
FirstOrDefaultAsync
∏∏ $
(
∏∏$ %
x
∏∏% &
=>
∏∏' )
x
∏∏* +
.
∏∏+ ,
PeopleId
∏∏, 4
==
∏∏5 7
person
∏∏8 >
.
∏∏> ?
PeopleId
∏∏? G
)
∏∏G H
;
∏∏H I
if
∫∫ 
(
∫∫ 
announcement
∫∫ 
==
∫∫ 
null
∫∫  $
)
∫∫$ %
{
ªª 
Console
ºº 
.
ºº 
	WriteLine
ºº !
(
ºº! "
$str
ºº" X
)
ººX Y
;
ººY Z
return
ΩΩ 
;
ΩΩ 
}
ææ 
Console
¿¿ 
.
¿¿ 
Write
¿¿ 
(
¿¿ 
$"
¿¿ ;
-What custom name would you like to assign to 
¿¿ I
{
¿¿I J
person
¿¿J P
.
¿¿P Q
Name
¿¿Q U
}
¿¿U V
?: 
¿¿V Y
"
¿¿Y Z
)
¿¿Z [
;
¿¿[ \
var
¡¡ 

customName
¡¡ 
=
¡¡ 
Console
¡¡ $
.
¡¡$ %
ReadLine
¡¡% -
(
¡¡- .
)
¡¡. /
;
¡¡/ 0
if
√√ 
(
√√ 

customName
√√ 
==
√√ 
$str
√√ $
)
√√$ %

customName
ƒƒ 
=
ƒƒ 
null
ƒƒ !
;
ƒƒ! "
Console
∆∆ 
.
∆∆ 
Write
∆∆ 
(
∆∆ 
$"
∆∆ *
Do you want to set the name 
∆∆ 8
{
∆∆8 9

customName
∆∆9 C
}
∆∆C D
 to 
∆∆D H
{
∆∆H I
person
∆∆I O
.
∆∆O P
Name
∆∆P T
}
∆∆T U
	? (y/n): 
∆∆U ^
"
∆∆^ _
)
∆∆_ `
;
∆∆` a
var
«« 
checkResult
«« 
=
«« 
Console
«« %
.
««% &
ReadLine
««& .
(
««. /
)
««/ 0
;
««0 1
if
…… 
(
…… 
checkResult
…… 
!=
…… 
$str
…… "
)
……" #
return
……$ *
;
……* +
announcement
ÀÀ 
.
ÀÀ 

CustomName
ÀÀ #
=
ÀÀ$ %

customName
ÀÀ& 0
;
ÀÀ0 1
await
ÕÕ 
	dbContext
ÕÕ 
.
ÕÕ 
SaveChangesAsync
ÕÕ ,
(
ÕÕ, -
)
ÕÕ- .
;
ÕÕ. /
}
ŒŒ 	
public
—— 
static
—— 
async
—— 
Task
——  
addGiftAsync
——! -
(
——- .
MainDbContext
——. ;
	dbContext
——< E
)
——E F
{
““ 	
Console
”” 
.
”” 
	WriteLine
”” 
(
”” 
$str
”” 0
)
””0 1
;
””1 2
while
’’ 
(
’’ 
true
’’ 
)
’’ 
{
÷÷ 
Console
◊◊ 
.
◊◊ 
Write
◊◊ 
(
◊◊ 
$str
◊◊ C
)
◊◊C D
;
◊◊D E
var
ÿÿ 
gift
ÿÿ 
=
ÿÿ 
Console
ÿÿ "
.
ÿÿ" #
ReadLine
ÿÿ# +
(
ÿÿ+ ,
)
ÿÿ, -
;
ÿÿ- .
Console
⁄⁄ 
.
⁄⁄ 
Write
⁄⁄ 
(
⁄⁄ 
$str
⁄⁄ F
)
⁄⁄F G
;
⁄⁄G H
var
€€ 

familyName
€€ 
=
€€  
Console
€€! (
.
€€( )
ReadLine
€€) 1
(
€€1 2
)
€€2 3
;
€€3 4
var
›› 
person
›› 
=
›› %
getPersonFromFamilyName
›› 4
(
››4 5
	dbContext
››5 >
,
››> ?

familyName
››@ J
)
››J K
;
››K L
if
ﬂﬂ 
(
ﬂﬂ 
person
ﬂﬂ 
==
ﬂﬂ 
null
ﬂﬂ "
)
ﬂﬂ" #
return
ﬂﬂ$ *
;
ﬂﬂ* +
Console
·· 
.
·· 
Write
·· 
(
·· 
$"
··  
Did 
··  $
{
··$ %
person
··% +
.
··+ ,
Name
··, 0
}
··0 1
	 get you 
··1 :
{
··: ;
gift
··; ?
}
··? @
	? (y/n): 
··@ I
"
··I J
)
··J K
;
··K L
var
‚‚ 
response
‚‚ 
=
‚‚ 
Console
‚‚ &
.
‚‚& '
ReadLine
‚‚' /
(
‚‚/ 0
)
‚‚0 1
;
‚‚1 2
if
‰‰ 
(
‰‰ 
response
‰‰ 
!=
‰‰ 
$str
‰‰  #
)
‰‰# $
continue
‰‰% -
;
‰‰- .
var
ÊÊ 
babyGift
ÊÊ 
=
ÊÊ 
new
ÊÊ "
	BabyGifts
ÊÊ# ,
{
ÊÊ- .
Gift
ÊÊ/ 3
=
ÊÊ4 5
gift
ÊÊ6 :
}
ÊÊ; <
;
ÊÊ< =
await
ËË 
	dbContext
ËË 
.
ËË  
	BabyGifts
ËË  )
.
ËË) *
AddAsync
ËË* 2
(
ËË2 3
babyGift
ËË3 ;
)
ËË; <
;
ËË< =
await
ÍÍ 
	dbContext
ÍÍ 
.
ÍÍ  
PeopleBabyGifts
ÍÍ  /
.
ÍÍ/ 0
AddAsync
ÍÍ0 8
(
ÍÍ8 9
new
ÍÍ9 <
PeopleBabyGifts
ÍÍ= L
{
ÎÎ 
People
ÏÏ 
=
ÏÏ 
person
ÏÏ #
,
ÏÏ# $
BabyGift
ÌÌ 
=
ÌÌ 
babyGift
ÌÌ '
,
ÌÌ' (
}
ÓÓ 
)
ÓÓ 
;
ÓÓ 
await
 
	dbContext
 
.
  
SaveChangesAsync
  0
(
0 1
)
1 2
;
2 3
break
ÚÚ 
;
ÚÚ 
}
ÛÛ 
}
ÙÙ 	
private
ˆˆ 
static
ˆˆ 
People
ˆˆ %
getPersonFromFamilyName
ˆˆ 5
(
ˆˆ5 6
MainDbContext
ˆˆ6 C
	dbContext
ˆˆD M
,
ˆˆM N
string
ˆˆO U

familyName
ˆˆV `
)
ˆˆ` a
{
˜˜ 	
People
¯¯ 
person
¯¯ 
=
¯¯ 
null
¯¯  
;
¯¯  !
using
˙˙ 
(
˙˙ 
var
˙˙ 
peopleEnumerator
˙˙ '
=
˙˙( )
	dbContext
˙˙* 3
.
˚˚ 
People
˚˚ 
.
¸¸ 
Where
¸¸ 
(
¸¸ 
x
¸¸ 
=>
¸¸ 
x
¸¸ 
.
¸¸ 

FamilyName
¸¸ (
.
¸¸( )
ToLower
¸¸) 0
(
¸¸0 1
)
¸¸1 2
==
¸¸3 5

familyName
¸¸6 @
.
¸¸@ A
ToLower
¸¸A H
(
¸¸H I
)
¸¸I J
)
¸¸J K
.
˝˝ 
GetEnumerator
˝˝ 
(
˝˝ 
)
˝˝  
)
˝˝  !
{
˛˛ 
while
ˇˇ 
(
ˇˇ 
peopleEnumerator
ˇˇ '
.
ˇˇ' (
MoveNext
ˇˇ( 0
(
ˇˇ0 1
)
ˇˇ1 2
)
ˇˇ2 3
{
ÄÄ 
person
ÅÅ 
=
ÅÅ 
peopleEnumerator
ÅÅ -
.
ÅÅ- .
Current
ÅÅ. 5
;
ÅÅ5 6
Console
ÇÇ 
.
ÇÇ 
Write
ÇÇ !
(
ÇÇ! "
$"
ÇÇ" $
Is it 
ÇÇ$ *
{
ÇÇ* +
person
ÇÇ+ 1
.
ÇÇ1 2
Name
ÇÇ2 6
}
ÇÇ6 7
 from 
ÇÇ7 =
{
ÇÇ= >
person
ÇÇ> D
.
ÇÇD E
City
ÇÇE I
}
ÇÇI J
,
ÇÇJ K
{
ÇÇK L
person
ÇÇL R
.
ÇÇR S
State
ÇÇS X
??
ÇÇY [
person
ÇÇ\ b
.
ÇÇb c
Country
ÇÇc j
}
ÇÇj k
	 (y/n)?: 
ÇÇk t
"
ÇÇt u
)
ÇÇu v
;
ÇÇv w
var
ÉÉ 
peopleResponse
ÉÉ &
=
ÉÉ' (
Console
ÉÉ) 0
.
ÉÉ0 1
ReadLine
ÉÉ1 9
(
ÉÉ9 :
)
ÉÉ: ;
;
ÉÉ; <
if
ÖÖ 
(
ÖÖ 
peopleResponse
ÖÖ &
==
ÖÖ' )
$str
ÖÖ* -
)
ÖÖ- .
return
ÜÜ 
person
ÜÜ %
;
ÜÜ% &
}
áá 
}
àà 
Console
ää 
.
ää 
	WriteLine
ää 
(
ää 
$str
ää N
)
ääN O
;
ääO P
return
åå 
person
åå 
;
åå 
}
çç 	
}
éé 
}èè ±:
6B:\Github\asagiv.dbmanager\asagiv.dbmanager\Program.cs
	namespace		 	
asagiv		
 
.		 
	dbmanager		 
{

 
class 	
Program
 
{ 
static 
async 
Task 
Main 
( 
string %
[% &
]& '
args( ,
), -
{ 	
var 
oldDbContext 
= 
new "
MainDbContext# 0
(0 1
$str1 >
,> ?
$str@ F
,F G
$strH N
,N O
$strP X
,X Y
$strZ d
)d e
;e f
var 
	dbContext 
= 
new 
AddressDbContext  0
(0 1
$str1 >
,> ?
$str@ F
,F G
$strH S
,S T
$strU ]
,] ^
$str_ i
)i j
;j k
await  
updateGiftsDbContext &
(& '
oldDbContext' 3
,3 4
	dbContext5 >
)> ?
;? @
} 	
private 
static 
async 
Task ! 
updateGiftsDbContext" 6
(6 7
MainDbContext7 D
oldDbContextE Q
,Q R
AddressDbContextS c
	dbContextd m
)m n
{ 	
var 
list 
= 
await 
oldDbContext )
. 
PeopleBabyGifts  
. 
ToListAsync 
( 
) 
; 
var 
groups 
= 
list 
. 
GroupBy %
(% &
x& '
=>( *
x+ ,
., -

BabyGiftId- 7
)7 8
;8 9
foreach 
( 
var 

personGift #
in$ &
groups' -
)- .
{ 
var   
gift   
=   
await    
oldDbContext  ! -
.  - .
	BabyGifts  . 7
.  7 8
FirstOrDefaultAsync  8 K
(  K L
x  L M
=>  N P
x  Q R
.  R S

BabyGiftId  S ]
==  ^ `

personGift  a k
.  k l
Key  l o
)  o p
;  p q
var"" 
babyGift"" 
="" 
new"" "
BabyGift""# +
{## 
giftDescription$$ #
=$$$ %
gift$$& *
.$$* +
Gift$$+ /
}%% 
;%% 
foreach'' 
('' 
var'' 
personGiftGroupItem'' 0
in''1 3

personGift''4 >
.''> ?
ToList''? E
(''E F
)''F G
)''G H
{(( 
var)) 
person)) 
=))  
await))! &
oldDbContext))' 3
.))3 4
People))4 :
.)): ;
FirstOrDefaultAsync)); N
())N O
x))O P
=>))Q S
x))T U
.))U V
PeopleId))V ^
==))_ a
personGiftGroupItem))b u
.))u v
PeopleId))v ~
)))~ 
;	)) Ä
if++ 
(++ 
gift++ 
==++ 
null++  $
||++% '
person++( .
==++/ 1
null++2 6
)++6 7
throw,, 
new,, !
	Exception,," +
(,,+ ,
$str,,, D
),,D E
;,,E F
var.. 
family.. 
=..  
	dbContext..! *
...* +
Families..+ 3
.// 
Where// 
(// 
x//  
=>//! #
x//$ %
.//% &
addressHeader//& 3
==//4 6
person//7 =
.//= >
Name//> B
)//B C
.00 
Where00 
(00 
x00  
=>00! #
x00$ %
.00% &
	addresses00& /
.00/ 0
FirstOrDefault000 >
(00> ?
)00? @
.00@ A
city00A E
==00F H
person00I O
.00O P
City00P T
)00T U
.11 
FirstOrDefault11 '
(11' (
)11( )
;11) *
var33 
familyBabyGift33 &
=33' (
new33) ,
FamilyBabyGift33- ;
{44 
family55 
=55  
family55! '
,55' (
babyGift66  
=66! "
babyGift66# +
,66+ ,
thankYouNoteWritten77 +
=77, -
gift77. 2
.772 3
TyNoteWritten773 @
}88 
;88 
	dbContext:: 
.:: 
	BabyGifts:: '
.::' (
Add::( +
(::+ ,
babyGift::, 4
)::4 5
;::5 6
	dbContext;; 
.;; 
FamilyBabyGifts;; -
.;;- .
Add;;. 1
(;;1 2
familyBabyGift;;2 @
);;@ A
;;;A B
}<< 
}== 
await?? 
	dbContext?? 
.?? 
SaveChangesAsync?? ,
(??, -
)??- .
;??. /
}@@ 	
privateBB 
staticBB 
asyncBB 
TaskBB !!
UpdatePeopleDbContextBB" 7
(BB7 8
MainDbContextBB8 E
oldDbContextBBF R
,BBR S
AddressDbContextBBT d
	dbContextBBe n
)BBn o
{CC 	
foreachDD 
(DD 
varDD 
peopleDD 
inDD  "
oldDbContextDD# /
.DD/ 0
PeopleDD0 6
)DD6 7
{EE 
ConsoleFF 
.FF 
	WriteLineFF !
(FF! "
peopleFF" (
.FF( )
NameFF) -
)FF- .
;FF. /
varHH 
familyHH 
=HH 
newHH  
FamilyHH! '
{II 

familyNameJJ 
=JJ  
peopleJJ! '
.JJ' (

FamilyNameJJ( 2
,JJ2 3
addressHeaderKK !
=KK" #
peopleKK$ *
.KK* +
NameKK+ /
,KK/ 0
	addressesLL 
=LL 
newLL  #
ListLL$ (
<LL( )
AddressLL) 0
>LL0 1
{MM 
newNN 
AddressNN #
{OO 
streetPP "
=PP# $
peoplePP% +
.PP+ ,
StreetPP, 2
,PP2 3
cityQQ  
=QQ! "
peopleQQ# )
.QQ) *
CityQQ* .
,QQ. /
stateRR !
=RR" #
peopleRR$ *
.RR* +
StateRR+ 0
,RR0 1
zipSS 
=SS  !
peopleSS" (
.SS( )
ZipSS) ,
,SS, -
countryTT #
=TT$ %
peopleTT& ,
.TT, -
CountryTT- 4
,TT4 5
}UU 
}VV 
,VV 
familyMembersWW !
=WW" #
newWW$ '
ListWW( ,
<WW, -
PersonWW- 3
>WW3 4
(WW4 5
)WW5 6
}XX 
;XX 
awaitZZ 
	dbContextZZ 
.ZZ  
FamiliesZZ  (
.ZZ( )
AddAsyncZZ) 1
(ZZ1 2
familyZZ2 8
)ZZ8 9
;ZZ9 :
}[[ 
await]] 
	dbContext]] 
.]] 
SaveChangesAsync]] ,
(]], -
)]]- .
;]]. /
}^^ 	
}__ 
}`` 