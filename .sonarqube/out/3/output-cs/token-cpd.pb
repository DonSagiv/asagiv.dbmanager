¨|
VB:\Github\asagiv.dbmanager\asasgiv.dbmanager.webinterface\Data\MainDbContextService.cs
	namespace		 	
asagiv		
 
.		 
	dbmanager		 
.		 
webinterface		 '
.		' (
Data		( ,
{

 
public 

class  
MainDbContextService %
{ 
public 
AddressDbContext 
	dbContext  )
{* +
get, /
;/ 0
private1 8
set9 <
;< =
}> ?
public  
MainDbContextService #
(# $
IConfiguration$ 2
configuration3 @
)@ A
{ 	
var 
	ipAddress 
= 
Environment '
.' ("
GetEnvironmentVariable( >
(> ?
$str? F
)F G
;G H
var 
port 
= 
Environment "
." #"
GetEnvironmentVariable# 9
(9 :
$str: C
)C D
;D E
var 
database 
= 
Environment &
.& '"
GetEnvironmentVariable' =
(= >
$str> G
)G H
;H I
var 
userName 
= 
Environment &
.& '"
GetEnvironmentVariable' =
(= >
$str> K
)K L
;L M
var 
password 
= 
Environment &
.& '"
GetEnvironmentVariable' =
(= >
$str> K
)K L
;L M
if 
( 
password 
== 
$str #
)# $
throw 
new 
	Exception #
(# $
$str$ @
)@ A
;A B
	dbContext 
= 
new 
AddressDbContext ,
(, -
	ipAddress- 6
,6 7
port8 <
,< =
database> F
,F G
userNameH P
,P Q
passwordR Z
)Z [
;[ \
} 	
public"" 
async"" 
Task"" 
<"" 
IList"" 
<""  
Family""  &
>""& '
>""' (
getFamiliesAsync"") 9
(""9 :
)"": ;
{## 	
return$$ 
await$$ 
	dbContext$$ "
.$$" #
Families$$# +
.%% 
OrderBy%% 
(%% 
x%% 
=>%% 
x%% 
.%%  

familyName%%  *
)%%* +
.&& 
ToListAsync&& 
(&& 
)&& 
;&& 
}'' 	
public)) 
async)) 
Task)) 
<)) 
IList)) 
<))  
Family))  &
>))& '
>))' (
filterFamiliesAsync))) <
())< =
string))= C
filterString))D P
)))P Q
{** 	
var++ 
asyncEnumerable++ 
=++  !
await++" '
getFamiliesAsync++( 8
(++8 9
)++9 :
;++: ;
return-- 
asyncEnumerable-- "
... 
Where.. 
(.. 
x.. 
=>.. 
x.. 
... 
ToSearchableString.. 0
(..0 1
)..1 2
...2 3
ToLower..3 :
(..: ;
)..; <
...< =
Contains..= E
(..E F
filterString..F R
...R S
ToLower..S Z
(..Z [
)..[ \
)..\ ]
)..] ^
.// 
ToList// 
(// 
)// 
;// 
}00 	
public22 
async22 
Task22 
<22 
IList22 
<22  
string22  &
>22& '
>22' ((
getFamilyAddressHeadersAsync22) E
(22E F
)22F G
{33 	
return44 
await44 
	dbContext44 "
.44" #
Families44# +
.55 
OrderBy55 
(55 
x55 
=>55 
x55 
.55  
addressHeader55  -
)55- .
.66 
Select66 
(66 
x66 
=>66 
x66 
.66 
ToString66 '
(66' (
)66( )
)66) *
.77 
ToListAsync77 
(77 
)77 
;77 
}88 	
public:: 
async:: 
Task:: 
<:: 
Family::  
>::  ! 
getFamilyFromIdAsync::" 6
(::6 7
long::7 ;
familyId::< D
)::D E
{;; 	
return<< 
await<< 
	dbContext<< "
.<<" #
Families<<# +
.== 
FirstOrDefaultAsync== $
(==$ %
x==% &
=>==' )
x==* +
.==+ ,
familyId==, 4
====5 7
familyId==8 @
)==@ A
;==A B
}>> 	
public@@ 
async@@ 
Task@@ 
saveFamilyAsync@@ )
(@@) *
Family@@* 0
family@@1 7
)@@7 8
{AA 	
ifBB 
(BB 
!BB 
	dbContextBB 
.BB 
FamiliesBB #
.BB# $
ContainsBB$ ,
(BB, -
familyBB- 3
)BB3 4
)BB4 5
awaitCC 
	dbContextCC 
.CC  
FamiliesCC  (
.CC( )
AddAsyncCC) 1
(CC1 2
familyCC2 8
)CC8 9
;CC9 :
awaitEE 
	dbContextEE 
.EE 
SaveChangesAsyncEE ,
(EE, -
)EE- .
;EE. /
}FF 	
publicHH 
asyncHH 
TaskHH 
deleteFamilyAsyncHH +
(HH+ ,
FamilyHH, 2
familyHH3 9
)HH9 :
{II 	
ifJJ 
(JJ 
!JJ 
	dbContextJJ 
.JJ 
FamiliesJJ #
.JJ# $
ContainsJJ$ ,
(JJ, -
familyJJ- 3
)JJ3 4
)JJ4 5
returnJJ6 <
;JJ< =
	dbContextLL 
.LL 
FamiliesLL 
.LL 
RemoveLL %
(LL% &
familyLL& ,
)LL, -
;LL- .
awaitNN 
	dbContextNN 
.NN 
SaveChangesAsyncNN ,
(NN, -
)NN- .
;NN. /
}OO 	
publicQQ 
asyncQQ 
TaskQQ 
<QQ 
IListQQ 
<QQ  
FamilyBabyGiftQQ  .
>QQ. /
>QQ/ 0 
getBabyGiftListAsyncQQ1 E
(QQE F
stringQQF L
filterStringQQM Y
=QQZ [
nullQQ\ `
)QQ` a
{RR 	
varSS 
familyBabyGiftsSS 
=SS  !
awaitSS" '
	dbContextSS( 1
.SS1 2
FamilyBabyGiftsSS2 A
.TT 
OrderByTT 
(TT 
xTT 
=>TT !
xTT" #
.TT# $
thankYouNoteWrittenTT$ 7
)TT7 8
.UU 
ThenByUU 
(UU 
xUU 
=>UU  
xUU! "
.UU" #
familyUU# )
.UU) *

familyNameUU* 4
)UU4 5
.VV 
ToListAsyncVV  
(VV  !
)VV! "
;VV" #
ifXX 
(XX 
!XX 
stringXX 
.XX 
IsNullOrWhiteSpaceXX *
(XX* +
filterStringXX+ 7
)XX7 8
)XX8 9
{YY 
returnZZ 
familyBabyGiftsZZ &
.[[ 
Where[[ 
([[ 
x[[ 
=>[[ 
x[[  !
.[[! "
ToString[[" *
([[* +
)[[+ ,
.[[, -
Contains[[- 5
([[5 6
filterString[[6 B
)[[B C
)[[C D
.\\ 
ToList\\ 
(\\ 
)\\ 
;\\ 
}]] 
return__ 
familyBabyGifts__ "
;__" #
}`` 	
publicbb 
asyncbb 
Taskbb 
addGiftAsyncbb &
(bb& '
BabyGiftbb' /
babyGiftbb0 8
,bb8 9
IListbb: ?
<bb? @
FamilyBabyGiftbb@ N
>bbN O!
familyBabyGiftsToSavebbP e
)bbe f
{cc 	
ifdd 
(dd 
!dd 
(dd 
awaitdd 
	dbContextdd !
.dd! "
	BabyGiftsdd" +
.dd+ ,
ContainsAsyncdd, 9
(dd9 :
babyGiftdd: B
)ddB C
)ddC D
)ddD E
awaitee 
	dbContextee 
.ee  
	BabyGiftsee  )
.ee) *
AddAsyncee* 2
(ee2 3
babyGiftee3 ;
)ee; <
;ee< =
vargg 
oldFamilyBabyGiftsgg "
=gg# $
awaitgg% *
	dbContextgg+ 4
.gg4 5
FamilyBabyGiftsgg5 D
.hh 
Wherehh 
(hh 
xhh 
=>hh 
xhh 
.hh 
babyGifthh &
==hh' )
babyGifthh* 2
)hh2 3
.ii 
ToListAsyncii 
(ii 
)ii 
;ii 
varkk #
familyBabyGiftsToRemovekk '
=kk( )
oldFamilyBabyGiftskk* <
.kk< =
Exceptkk= C
(kkC D!
familyBabyGiftsToSavekkD Y
)kkY Z
.kkZ [
ToListkk[ a
(kka b
)kkb c
;kkc d
	dbContextll 
.ll 
FamilyBabyGiftsll %
.ll% &
RemoveRangell& 1
(ll1 2#
familyBabyGiftsToRemovell2 I
)llI J
;llJ K
	dbContextmm 
.mm 
FamilyBabyGiftsmm %
.mm% &
UpdateRangemm& 1
(mm1 2!
familyBabyGiftsToSavemm2 G
)mmG H
;mmH I
awaitoo 
	dbContextoo 
.oo 
SaveChangesAsyncoo ,
(oo, -
)oo- .
;oo. /
}pp 	
publicrr 
asyncrr 
Taskrr 
<rr 
longrr 
?rr 
>rr  
getGiftrr! (
(rr( )
stringrr) /
giftrr0 4
,rr4 5
stringrr6 <
namerr= A
,rrA B
stringrrC I
cityrrJ N
)rrN O
{ss 	
vartt 
familytt 
=tt 
awaittt 
	dbContexttt (
.uu 
Familiesuu 
.vv 
Wherevv 
(vv 
xvv 
=>vv 
xvv 
.vv 
	addressesvv '
.vv' (
FirstOrDefaultvv( 6
(vv6 7
)vv7 8
.vv8 9
cityvv9 =
==vv> @
cityvvA E
)vvE F
.ww 
FirstOrDefaultAsyncww $
(ww$ %
xww% &
=>ww' )
xww* +
.ww+ ,

familyNameww, 6
==ww7 9
nameww: >
)ww> ?
;ww? @
varyy 

familyGiftyy 
=yy 
awaityy "
	dbContextyy# ,
.zz 
FamilyBabyGiftszz  
.{{ 
FirstOrDefaultAsync{{ $
({{$ %
x{{% &
=>{{' )
x{{* +
.{{+ ,
familyId{{, 4
=={{5 7
family{{8 >
.{{> ?
familyId{{? G
){{G H
;{{H I
return}} 
await}} 
	dbContext}} "
.}}" #
	BabyGifts}}# ,
.~~ 
Where~~ 
(~~ 
x~~ 
=>~~ 
x~~ 
.~~ 
giftDescription~~ -
==~~. 0
gift~~1 5
)~~5 6
. 
Where 
( 
x 
=> 
x 
. 
giftId $
==% '

familyGift( 2
.2 3

babyGiftId3 =
)= >
.
ÄÄ 
Select
ÄÄ 
(
ÄÄ 
x
ÄÄ 
=>
ÄÄ 
x
ÄÄ 
.
ÄÄ 
giftId
ÄÄ %
)
ÄÄ% &
.
ÅÅ !
FirstOrDefaultAsync
ÅÅ $
(
ÅÅ$ %
)
ÅÅ% &
;
ÅÅ& '
}
ÇÇ 	
public
ÑÑ 
async
ÑÑ 
Task
ÑÑ 
<
ÑÑ 
IList
ÑÑ 
<
ÑÑ  
FamilyBabyGift
ÑÑ  .
>
ÑÑ. /
>
ÑÑ/ 0
getPeopleFromGift
ÑÑ1 B
(
ÑÑB C
BabyGift
ÑÑC K
babyGift
ÑÑL T
)
ÑÑT U
{
ÖÖ 	
return
ÜÜ 
await
ÜÜ 
	dbContext
ÜÜ "
.
ÜÜ" #
FamilyBabyGifts
ÜÜ# 2
.
áá 
Where
áá 
(
áá 
x
áá 
=>
áá 
x
áá 
.
áá 

babyGiftId
áá (
==
áá) +
babyGift
áá, 4
.
áá4 5
giftId
áá5 ;
)
áá; <
.
àà 
ToListAsync
àà 
(
àà 
)
àà 
;
àà 
}
ââ 	
public
ãã 
async
ãã 
Task
ãã 
<
ãã 
BabyGift
ãã "
>
ãã" # 
getGiftFromIdAsync
ãã$ 6
(
ãã6 7
long
ãã7 ;
?
ãã; <
giftId
ãã= C
)
ããC D
{
åå 	
return
çç 
await
çç 
	dbContext
çç "
.
çç" #
	BabyGifts
çç# ,
.
éé 
Where
éé 
(
éé 
x
éé 
=>
éé 
x
éé 
.
éé 
giftId
éé $
==
éé% '
giftId
éé( .
)
éé. /
.
èè !
FirstOrDefaultAsync
èè $
(
èè$ %
)
èè% &
;
èè& '
}
êê 	
public
íí 
async
íí 
Task
íí "
deleteFamilyBabyGift
íí .
(
íí. /
FamilyBabyGift
íí/ =
e
íí> ?
)
íí? @
{
ìì 	
	dbContext
îî 
.
îî 
FamilyBabyGifts
îî %
.
îî% &
Remove
îî& ,
(
îî, -
e
îî- .
)
îî. /
;
îî/ 0
var
ññ 
anyGifts
ññ 
=
ññ 
await
ññ  
	dbContext
ññ! *
.
óó 
FamilyBabyGifts
óó  
.
òò 
Where
òò 
(
òò 
x
òò 
=>
òò 
x
òò 
!=
òò  
e
òò! "
)
òò" #
.
ôô 
AnyAsync
ôô 
(
ôô 
x
ôô 
=>
ôô 
e
ôô  
.
ôô  !

babyGiftId
ôô! +
==
ôô, .
x
ôô/ 0
.
ôô0 1

babyGiftId
ôô1 ;
)
ôô; <
;
ôô< =
if
õõ 
(
õõ 
anyGifts
õõ 
==
õõ 
false
õõ !
)
õõ! "
	dbContext
úú 
.
úú 
	BabyGifts
úú #
.
úú# $
Remove
úú$ *
(
úú* +
e
úú+ ,
.
úú, -
babyGift
úú- 5
)
úú5 6
;
úú6 7
await
ûû 
	dbContext
ûû 
.
ûû 
SaveChangesAsync
ûû ,
(
ûû, -
)
ûû- .
;
ûû. /
}
üü 	
public
°° 
async
°° 
Task
°° 
setTyNoteWritten
°° *
(
°°* +
FamilyBabyGift
°°+ 9
e
°°: ;
)
°°; <
{
¢¢ 	
e
££ 
.
££ !
thankYouNoteWritten
££ !
=
££" #
!
££$ %
e
££% &
.
££& '!
thankYouNoteWritten
££' :
;
££: ;
	dbContext
•• 
.
•• 
FamilyBabyGifts
•• %
.
••% &
Update
••& ,
(
••, -
e
••- .
)
••. /
;
••/ 0
await
ßß 
	dbContext
ßß 
.
ßß 
SaveChangesAsync
ßß ,
(
ßß, -
)
ßß- .
;
ßß. /
}
®® 	
}
™™ 
}´´ ´
RB:\Github\asagiv.dbmanager\asasgiv.dbmanager.webinterface\Data\SelectedListItem.cs
	namespace 	
asagiv
 
. 
	dbmanager 
. 
webinterface '
.' (
Data( ,
{ 
public 

class 
SelectedListItem !
<! "
T" #
># $
{		 
public

 
T

 
value

 
{

 
get

 
;

 
set

 !
;

! "
}

# $
} 
} Á

DB:\Github\asagiv.dbmanager\asasgiv.dbmanager.webinterface\Program.cs
	namespace 	
asagiv
 
. 
	dbmanager 
. 
webinterface '
{ 
public 

class 
Program 
{ 
public		 
static		 
void		 
Main		 
(		  
string		  &
[		& '
]		' (
args		) -
)		- .
{

 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} ë
DB:\Github\asagiv.dbmanager\asasgiv.dbmanager.webinterface\Startup.cs
	namespace 	
asagiv
 
. 
	dbmanager 
. 
webinterface '
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
AddRazorPages "
(" #
)# $
;$ %
services 
. 
AddServerSideBlazor (
(( )
)) *
;* +
services 
. 
	AddScoped 
<  
MainDbContextService 3
>3 4
(4 5
)5 6
;6 7
services   
.   
AddBlazorFileSaver   '
(  ' (
)  ( )
;  ) *
services!! 
.!! 
AddBlazoredModal!! %
(!!% &
)!!& '
;!!' (
services"" 
."" 
AddBlazorise"" !
(""! "
)""" #
;""# $
services## 
.## !
AddBootstrapProviders## *
(##* +
)##+ ,
;##, -
services$$ 
.$$ 
AddFontAwesomeIcons$$ (
($$( )
)$$) *
;$$* +
}%% 	
public(( 
void(( 
	Configure(( 
((( 
IApplicationBuilder(( 1
app((2 5
,((5 6
IWebHostEnvironment((7 J
env((K N
)((N O
{)) 	
if** 
(** 
env** 
.** 
IsDevelopment** !
(**! "
)**" #
)**# $
{++ 
app,, 
.,, %
UseDeveloperExceptionPage,, -
(,,- .
),,. /
;,,/ 0
}-- 
else.. 
{// 
app00 
.00 
UseExceptionHandler00 '
(00' (
$str00( 0
)000 1
;001 2
app22 
.22 
UseHsts22 
(22 
)22 
;22 
}33 
app66 
.66 
UseStaticFiles66 
(66 
)66  
;66  !
app88 
.88 
UseHttpsRedirection88 #
(88# $
)88$ %
;88% &
app:: 
.:: 

UseRouting:: 
(:: 
):: 
;:: 
app<< 
.<< 
UseEndpoints<< 
(<< 
	endpoints<< &
=><<' )
{== 
	endpoints>> 
.>> 
MapBlazorHub>> &
(>>& '
)>>' (
;>>( )
	endpoints?? 
.?? 
MapFallbackToPage?? +
(??+ ,
$str??, 4
)??4 5
;??5 6
}@@ 
)@@ 
;@@ 
}AA 	
}BB 
}CC ¡
WB:\Github\asagiv.dbmanager\asasgiv.dbmanager.webinterface\ViewModels\FamilyViewModel.cs
	namespace 	
asagiv
 
. 
	dbmanager 
. 
webinterface '
.' (

ViewModels( 2
{ 
public 

class 
FamilyViewModel  
{ 
public 
Family 
family 
{ 
get "
;" #
}$ %
public		 
bool		 
	isVisible		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public 
FamilyViewModel 
( 
Family %
familyInput& 1
)1 2
{ 	
family 
= 
familyInput  
;  !
} 	
public 
string 
[ 
] 
getAddressLines '
(' (
)( )
{ 	
var 
sb 
= 
new 
StringBuilder &
(& '
)' (
;( )
foreach 
( 
var 
address  
in! #
family$ *
.* +
	addresses+ 4
)4 5
{ 
sb 
. 

AppendLine 
( 
address %
.% &
ToString& .
(. /
)/ 0
)0 1
;1 2
sb 
. 

AppendLine 
( 
$str "
)" #
;# $
} 
return 
sb 
. 
ToString 
( 
)  
.  !
Split! &
(& '
$char' +
)+ ,
;, -
} 	
public 
string 
[ 
] 
getPeopleLines &
(& '
)' (
{ 	
var 
sb 
= 
new 
StringBuilder &
(& '
)' (
;( )
foreach!! 
(!! 
var!! 
person!! 
in!!  "
family!!# )
.!!) *
familyMembers!!* 7
)!!7 8
{"" 
sb## 
.## 

AppendLine## 
(## 
person## $
.##$ %
ToString##% -
(##- .
)##. /
)##/ 0
;##0 1
}$$ 
return&& 
sb&& 
.&& 
ToString&& 
(&& 
)&&  
.&&  !
Split&&! &
(&&& '
$char&&' +
)&&+ ,
;&&, -
}'' 	
}(( 
})) 